<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Terrassa’s Buildings by gdsa-upc</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Terrassa’s Buildings</h1>
        <h2>Projecte GDSA</h2>
        <a href="https://github.com/gdsa-upc/Terrassa-s-Buildings" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>Aquesta web neix a partir de l'assignatura Gestió i Distribució de Senyals Audiovisuals, on es planteja el desenvolupament d'un projecte que es basa en la cerca visual. Aquest projecte l'hem donat com a nom Terrassa's Buildings i els seus desenvolupadors són:</p>

<table>
<thead>
<tr>
<th>Nom i Cognom</th>
<th>Perfil Github</th>
<th>Perfil de LinkedIn</th>
</tr>
</thead>
<tbody>
<tr>
<td>Marta Barrachina</td>
<td><a href="https://github.com/Mmarta19">Enllaç</a></td>
<td><a href="https://es.linkedin.com/in/marta-barrachina-234697117">Enllaç</a></td>
</tr>
<tr>
<td>Marta Coll</td>
<td><a href="https://github.com/MartaCollPol">Enllaç</a></td>
<td></td>
</tr>
<tr>
<td>David Molina</td>
<td><a href="https://github.com/Damocle21">Enllaç</a></td>
<td></td>
</tr>
</tbody>
</table>

<p>En concret Terrassa's Buildings és una plataforma que està implementada i desenvolupada amb el llenguatge Python. Per entendre millor el projecta, s'ha dividit aquest en sessions. En cada una de les sessions s'explica en detall els passos que s'han portat a terme per obtenir l'objectiu final.</p>

<table>
<thead>
<tr>
<th>Sessions</th>
<th>informe</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sessió 3</td>
<td><a href="https://docs.google.com/presentation/d/10qN_5L64CRrDN-KxAChikhTSHKhgo5Zdgb-cuL4wFAA/edit?usp=sharing">Extracció de característiques</a></td>
</tr>
<tr>
<td>Sessió 4</td>
<td><a href="https://docs.google.com/presentation/d/1BYy3HgLG6q_1lNq15vN7Gp8xHzMo9Y2DdIURvjgpsQ4/edit?usp=sharing">Sistema aleatori</a></td>
</tr>
</tbody>
</table>

<h1>
<a id="sessió-3" class="anchor" href="#sessi%C3%B3-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://docs.google.com/presentation/d/10qN_5L64CRrDN-KxAChikhTSHKhgo5Zdgb-cuL4wFAA/edit?usp=sharing">Sessió 3</a>
</h1>

<p>En aquesta primera part del projecte s'ha realitzat una <a href="https://drive.google.com/file/d/0BwPBlegi0csQamhIU3YyT1o3ZGs/view?usp=sharing">Base de Dades</a> amb 150 imatges diferents. Majoritàriament trobem imatges del Museu de la Ciència i la Tecnologia de Terrassa, del Mercat de la Independència. Encara així, en la base de dades també hi han imatges d'edificis desconeguts. Totes aquestes fotografies serviran d'entrenament al sistema. </p>

<table>
<thead>
<tr>
<th><a href="http://mnactec.cat/ca/">MNACTEC</a></th>
<th><a href="http://www.mercatdelaindependencia.cat/?doing_wp_cron=1479940928.3758389949798583984375">Mercat de la Independència</a></th>
<th>Desconegut</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/gh-pages/images/1354-30624-16524.jpg?raw=true" alt=""></td>
<td><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/gh-pages/images/3311-27747-29929.jpg?raw=true" alt=""></td>
<td><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/gh-pages/images/Desconegut_102.jpg?raw=true" alt=""></td>
</tr>
</tbody>
</table>

<p>El sistema també farà servir 450 fotografies de diferents edificis de Terrassa, on la seva utilitat és de validació que serviran per evaluar el sistema. Aquestes imatges es poden trobar a la pàgina web del UPC <a href="https://imatge.upc.edu/web/resources/terrassa-buildings-900">Terrassa Building 900</a>.</p>

<p>Un cop hem obtingut totes les imatges, és important fer una anotació d'aquestes per generar correctament la base de dades. El sistema d'anotació que s'ha utilitzat en aquest projecte és el següent:</p>

<p><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/gh-pages/images/Captura%20de%20pantalla%202016-11-27%20a%20les%2011.31.12.png?raw=true" alt=""></p>

<p>Totes aquestes imatges s'han guardat en un arxiu <a href="https://drive.google.com/file/d/0BwPBlegi0csQamhIU3YyT1o3ZGs/view?usp=sharing">ZIP</a>.</p>

<p>Pel desenvolupament del projecta s'ha fet servir dos entorns de desenvolupament local.</p>

<ul>
<li><p><a href="https://www.enthought.com/products/canopy/">Canopy</a>: Entorn d'anàlisi de Python integral que proporciona més de 450 paquets de Python.</p></li>
<li><p><a href="https://atom.io">Atom</a>: Editor de text de software lliure en el que es pot treballar còmodament amb diferents idiomes de programació. Disposa de molts paquets descarregables que amplien les seves funcions com ara compiladors o personalitzadors. </p></li>
</ul>

<p>Amb aquestes dos entorns s'ha genera el primer script. Aquest es basa en l'extracció de punts d'interès d'una imatges. S'ha fet de dos extractors de característiques diferents, SURF, SIFT i ORB. A continuació podeu veure els codis realitzats agafant d'exemple, en els dos primers casos (SURF i SIFT), una imatge d'un tigre. En el cas d'ORB es fa servir una imatge de la nostre base de dades.</p>

<ul>
<li>SURFT</li>
</ul>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> numpy <span class="pl-k">as</span> np
<span class="pl-k">import</span> cv2
<span class="pl-k">import</span> matplotlib.pyplot <span class="pl-k">as</span> plt


img <span class="pl-k">=</span> cv2.imread(<span class="pl-s"><span class="pl-pds">'</span>//Users/Marta/Desktop/fotos escriptori/TIGRE.JPG<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>)
surf <span class="pl-k">=</span> cv2.SURF(<span class="pl-c1">4000</span>)
kp, des <span class="pl-k">=</span> surf.detectAndCompute(img, <span class="pl-c1">None</span>)
img2 <span class="pl-k">=</span> cv2.drawKeypoints(img, kp, <span class="pl-c1">None</span>, (<span class="pl-c1">255</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>), <span class="pl-c1">4</span>)
plt.imshow(img2),plt.show()
<span class="pl-c1">print</span> <span class="pl-c1">len</span>(kp)</pre></div>

<p><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/master/1--Keypoints/figure_1.png?raw=true" alt=""></p>

<p>Utilitzant SURFT podem observar que ens detalla els contorns més pronunciats de la imatge.</p>

<ul>
<li>SIFT </li>
</ul>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> numpy <span class="pl-k">as</span> np
<span class="pl-k">import</span> cv2
<span class="pl-k">import</span> matplotlib.pyplot <span class="pl-k">as</span> plt


img <span class="pl-k">=</span> cv2.imread(<span class="pl-s"><span class="pl-pds">'</span>//Users/Marta/Desktop/fotos escriptori/TIGRE.JPG<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>)
sift <span class="pl-k">=</span> cv2.SIFT(<span class="pl-c1">4000</span>)
kp, des <span class="pl-k">=</span> sift.detectAndCompute(img, <span class="pl-c1">None</span>)
img2 <span class="pl-k">=</span> cv2.drawKeypoints(img, kp, <span class="pl-c1">None</span>, (<span class="pl-c1">255</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>), <span class="pl-c1">4</span>)
plt.imshow(img2),plt.show()
<span class="pl-c1">print</span> <span class="pl-c1">len</span>(kp)</pre></div>

<p><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/master/1--Keypoints/Imagen%201.png?raw=true" alt=""></p>

<p>En aquest cas com veiem a la imatge anterior, el resultat de l'extracció de característiques és més detallat. Sobretot en els canvis d'intensitat, és a dir, en els contorns.</p>

<ul>
<li>ORB</li>
</ul>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> numpy <span class="pl-k">as</span> np
<span class="pl-k">import</span> cv2
<span class="pl-k">from</span> matplotlib <span class="pl-k">import</span> pyplot <span class="pl-k">as</span> plt
img <span class="pl-k">=</span> cv2.imread(<span class="pl-s"><span class="pl-pds">'</span>/home/marta/Desktop/GDSA/Mercat.JPG<span class="pl-pds">'</span></span>,<span class="pl-c1">0</span>)
<span class="pl-c">#linea que soluciona un bug de opencv</span>
cv2.ocl.setUseOpenCL(<span class="pl-c1">False</span>)
<span class="pl-c"># Initiate STAR detector</span>
orb <span class="pl-k">=</span> cv2.ORB_create(<span class="pl-c1">200000</span>)

<span class="pl-c"># find the keypoints with ORB</span>
kp <span class="pl-k">=</span> orb.detect(img,<span class="pl-c1">None</span>)

<span class="pl-c"># compute the descriptors with ORB</span>
kp, des <span class="pl-k">=</span> orb.compute(img, kp)

<span class="pl-c"># draw only keypoints location,not size and orientation</span>
img2 <span class="pl-k">=</span> cv2.drawKeypoints(img,kp,<span class="pl-c1">None</span>,<span class="pl-v">color</span><span class="pl-k">=</span>(<span class="pl-c1">255</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>), <span class="pl-v">flags</span><span class="pl-k">=</span><span class="pl-c1">0</span>)
plt.imshow(img2),plt.show()</pre></div>

<p><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/Marta-C/Mercat.png?raw=true" alt=""></p>

<p>Observem de color vermell els punts d'interés que s'han trobat a la imatge que corresponen sobretot a contorns o zones amb variacions ràpides de color(com les lletres del cartell). En aquest cas, ens podem fixar que en un dels contorns de la imatge tenim un marca generada per la funda del telèfon amb el qual s'estava capturant la imatge. Això pot ser un cas real i és per aquest motiu que ho hem volgut fer servir.</p>

<p>Les proves d'aquest primer script també s'han realitzat a <a href="http://jupyter.org">Jupyter</a>. Podeu veure tot el codi realitzat a <a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/tree/master/1--Keypoints">GitHub</a>.</p>

<h1>
<a id="sessió-4" class="anchor" href="#sessi%C3%B3-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://docs.google.com/presentation/d/1BYy3HgLG6q_1lNq15vN7Gp8xHzMo9Y2DdIURvjgpsQ4/edit?usp=sharing">Sessió 4</a>
</h1>

<p>Aquesta sessió està formada pels següents blocs:</p>

<p><img src="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/gh-pages/images/Captura%20de%20pantalla%202016-11-29%20a%20les%2022.03.21.png?raw=true" alt=""></p>

<p>En el primer bloc, la intenció es genera una base de dades. La funció s'anomena build_database i el resultat és el que es mostra a continuació:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c"># -*- coding: utf-8 -*-</span>
<span class="pl-k">import</span> os 

<span class="pl-k">def</span> <span class="pl-en">build_database</span> (<span class="pl-smi">indir</span>,<span class="pl-smi">outdir</span>): <span class="pl-c">#definim la funció</span>
    images <span class="pl-k">=</span> os.listdir(indir)  <span class="pl-c">#llegeixo tots els noms dels fitxers del directori d'entrada i els guarda a imatges</span>
    outfile <span class="pl-k">=</span> <span class="pl-c1">open</span>(outdir<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>/ID.txt<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>w<span class="pl-pds">'</span></span>)   <span class="pl-c">#crea el fitxer on escriu els id.</span>
    <span class="pl-k">for</span> <span class="pl-v">file</span> <span class="pl-k">in</span> images: <span class="pl-c">#recorre tots els id i els escriu al fitxer</span>
        outfile.write(<span class="pl-v">file</span>[<span class="pl-c1">0</span>:<span class="pl-k">-</span><span class="pl-c1">4</span>]<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>) 
        <span class="pl-c1">print</span>(<span class="pl-v">file</span>)
    outfile.close()<span class="pl-c">#tanca el fitxer</span>


ruta1<span class="pl-k">=</span>os.path.dirname(os.path.abspath(<span class="pl-c1">__file__</span>))<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>/TerrassaBuildings900/val/images<span class="pl-pds">'</span></span>
ruta2<span class="pl-k">=</span>os.path.dirname(os.path.abspath(<span class="pl-c1">__file__</span>))<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>/TerrassaBuildings900/train/images<span class="pl-pds">'</span></span>
savepath1<span class="pl-k">=</span>os.path.dirname(os.path.abspath(<span class="pl-c1">__file__</span>))<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>/TerrassaBuildings900/val<span class="pl-pds">'</span></span>
savepath2<span class="pl-k">=</span>os.path.dirname(os.path.abspath(<span class="pl-c1">__file__</span>))<span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>/TerrassaBuildings900/train<span class="pl-pds">'</span></span>

build_database(ruta1,savepath1)
build_database(ruta2,savepath2)</pre></div>

<p>Un cop ja tenim això, el següent pas és fer el Feature Extraction. Aquesta part està formada pels següents funcions:</p>

<ul>
<li><a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/Marta-B/sessio-4/Feature-Extraction/get_local_features.py">Get_Local_Featrures</a></li>
<li>
<a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/David/sessi--4/Train_codebook.py">Train_codebook</a> </li>
<li><a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/David/sessi--4/Get_assignments.py">Get_assignments</a></li>
<li><a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/blob/David/sessi--4/build_bow.py">Build_bow</a></li>
</ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/gdsa-upc/Terrassa-s-Buildings/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/gdsa-upc/Terrassa-s-Buildings"></a> is maintained by <a href="https://github.com/gdsa-upc">gdsa-upc</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
